"use strict";!function(e,t,n){function s(){var s={createEle:function(e,n){var s=t.createElement(e);for(var i in n)n.hasOwnProperty(i)&&(s[i]=n[i]);return s},extends:function(e,t){var n=arguments;if(n.length>2)return this.extends.apply(this,this.slice.call(n,1));for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e},slice:[].slice,getAgent:function(){var e=/mobile/i;return{isMobile:e.test(navigator.userAgent)}},calcDistance:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},addEvent:function(e,n,i,o){var c=this;if(n=r.isMobile?{click:"touchend"}[n]||n:n,!e)throw new Error("未找到需绑定事件的元素");3===arguments.length&&(o=i),"string"==typeof e&&(e=s.slice.call(t.querySelectorAll(e),0)),e=[].concat(e),arguments.length>3?e.forEach(function(e){e.addEventListener(n,function(t){var n=t.srcElement||t.originalTarget,s=c.slice.call(e.querySelectorAll(i),0),r=s.indexOf(n);r>-1&&o.call(s[r],t,r,s)})}):e.forEach(function(e){e.addEventListener(n,o)})}},i={currentIndex:0,lastIndex:0,currentImg:n,imgs:[],setImgs:function(e){this.imgs=e},setImg:function(e){var t=this.imgs.length-1;e<0&&(e=t),e>t&&(e=0),this.lastIndex=this.currentImg,this.currentImg=this.imgs[e],this.currentIndex=e}},o={init:function(){var e=r.isMobile=s.getAgent().isMobile,n=t.getElementById("crab_popup_style")||s.createEle("style",{id:"crab_popup_style",innerText:""}),i=e?'<div id="crab_popup_pane"><div class="img_box"></div></div><span class="crab_popup_close"></span>':'<span class="prev change"></span><div id="crab_popup_pane"><div class="img_box"></div><div class="page_num"></div></div><span class="crab_popup_close"></span><span class="next change"></span>',o=this.box=t.getElementById("crab_popup_box")||s.createEle("div",{id:"crab_popup_box",className:e?"mobile":"pc",innerHTML:i});t.head.appendChild(n),t.body.appendChild(o)},currentImg:n,setImg:function(){var n=i.imgs[i.currentIndex],o=t.getElementById("crab_popup_box"),c=t.getElementById("crab_popup_pane"),a=c.querySelector(".img_box"),l=c.querySelector(".page_num"),u=s.createEle("img",{onload:function(n){var s=n.target,i=e.getComputedStyle(s),o=parseInt(i.width),c=parseInt(i.height),a=o/c,l=t.body.scrollWidth,u=t.body.scrollHeight,d=l/u;r.isMobile&&(o>=c||a>d?s.style.width=l+"px":s.style.height=u+"px")},src:n.src});a.innerHTML="",a.appendChild(u),this.currentImg=u,r.isMobile||(l.innerText=i.currentIndex+1+" / "+i.imgs.length),o.style.display="block",t.body.style.overflow="hidden",o.classList.add("show")},close:function(){var e=this.box;e.classList.remove("show"),t.body.style.overflow="auto",setTimeout(function(){e.style.display="none"},250)}},r={root:[],defaults:{selector:"img",maskClosable:!0},touch:{count:0},init:function(e,n){if(!e)throw new Error("未传入DOM节点");1!==e.nodeType&&(e=s.slice.call(t.querySelectorAll(e),0)),this.root=[].concat(e),this.opts=s.extends({},this.defaults,n),o.init(),this.bindEvent()},bindEvent:function(){var n=this,c=t.getElementById("crab_popup_box"),a=c.querySelector("#crab_popup_pane"),l=c.querySelector(".crab_popup_close");if(this.root.forEach(function(e){s.addEvent(e,"click",n.opts.selector,function(t,s,o){var r=i.imgs.indexOf(o[s]);if(r>-1)n.setImg(r);else{var c=[].slice.call(e.querySelectorAll(n.opts.contextSelector),0),a=o[s];if(c.length)for(var l=c.length-1;l>=0;l--){var u=[].slice.call(c[l].querySelectorAll(n.opts.selector),0),d=u.indexOf(a);if(d>-1){n.setImg(d,u);break}}else n.setImg(s,o)}}.bind(e))}),this.isMobile){a.querySelector("img");s.addEvent(a,"touchstart","img",function(e){var t=e.touches[0],s=n.touch;o.currentImg.style.transformOrigin=t.clientX+"px "+(t.clientY+10)+"px",s.y=t.clientY}),s.addEvent(a,"touchstart",function(e){var t=e.touches[0],s=n.touch;s.start=!0,s.x=t.clientX}),s.addEvent(a,"touchmove","img",function(t){var s=t.touches[0].clientY,i=n.touch.y,r=Math.abs(s-i),c=Math.sqrt(e.screen.height/2);Math.abs(r)>30&&(n.touch.start=!1,o.currentImg.style.transform="scale("+2*Math.sqrt(r)/c+")")}),s.addEvent(a,"touchend",function(e){var t=n.touch,s=e.changedTouches[0],i=s.clientX,c=i-t.x,a=c>0?1:-1,l={"-1":r.next.bind(r),1:r.prev.bind(r)}[a];t.start?(Math.abs(c)>=50&&l(),t.start=!1):o.currentImg.style.transform="scale(1)"})}else!function(){var e=c.querySelector(".prev"),t=c.querySelector(".next");s.addEvent(e,"mouseover",function(){e.classList.add("show"),t.classList.add("show")}),s.addEvent(t,"mouseover",function(){e.classList.add("show"),t.classList.add("show")}),s.addEvent(e,"mouseleave",function(){e.classList.remove("show"),t.classList.remove("show")}),s.addEvent(t,"mouseleave",function(){e.classList.remove("show"),t.classList.remove("show")}),s.addEvent(e,"click",function(e){e.stopPropagation(),n.prev()}),s.addEvent(t,"click",function(e){e.stopPropagation(),n.next()}),s.addEvent(a,"click",function(e){e.stopPropagation()}),n.opts.maskClosable&&c.addEventListener("click",function(){o.close()})}();s.addEvent(l,"click",function(e){e.stopPropagation(),o.close()})},setImg:function(e){var t=arguments.length<=1||arguments[1]===n?i.imgs:arguments[1];i.setImgs(t),i.setImg(e),o.setImg()},prev:function(){this.isMobile&&(o.currentImg.style.transform="translateX(100%)"),i.setImg(--i.currentIndex),setTimeout(o.setImg.bind(o,!0),250),o.setImg()},next:function(){this.isMobile&&(o.currentImg.style.transform="translateX(-100%)"),i.setImg(++i.currentIndex),o.setImg()}};this.init=r.init.bind(r)}e.Popup=new s}(window,window.document);